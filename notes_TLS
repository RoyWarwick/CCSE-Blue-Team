Create keys for a CA, aggreagor and sensor:
openssl genrsa -out ca.key 4096

Create the CA's self-signed certificate:
openssl req -new -x509 -days 365 -key ca.key -out ca.crt

Create a certificate signing request for aggregator or sensor :
    Take the openssl.cnf file (adapted by Roy) are replace <local-IP> with the ipaddress (VERY IMPORTANT for the next step); then run:
echo -ne "\n\n\n\n\n\n\n\n\n" | openssl req -out server.csr -key server.key -new -config openssl.cnf

# Note: the file server.key has already been created with the first command and try not to create files with the same names

Now the CA can sign a request:
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365 -extensions v3_req -extfile openssl.cnf

On the aggregator; add the following to /etc/mosquitto/mosquitto.conf:
port 8883
cafile /foobar/ca.crt
certfile /foobar/server.crt
keyfile /foobar/server.key
require_certificate true

# Note: ensure the correct paths to the files are given (in place of foobar)

To use mosquitto_pub and _sub, add the following to each command (giving correct paths to the files):
-p 8883 --cafile ca.crt --cert server.crt --key server.key -h <the same ipaddress in the certificate>
